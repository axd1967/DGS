
Installation instructions
-------------------------

Requirements:

*) A webserver which can use php, e.g., apache <http://httpd.apache.org>
*) PHP >= 4.1.0 <http://www.php.net>
*) MySQL >= 4.0.1 <http://www.mysql.com>
*) cvs client <http://www.cvshome.org>

*) GD to draw rating graph <http://www.boutell.com/gd/>
*) FreeType for optional fonts in rating graph <http://www.freetype.org>

Last versions used by Dragon:
 Apache Version Apache/1.3.29 (Unix) PHP/4.3.4
 MySQL 4.0.15




1) Download:

Either from cvs:
(( CAUTION: Recently, sourceforge.net disable the anonymous use of cvs.
   You must register yourself. Read the SourceForge documentations. ))

> cd /path/to/the/directory/where/you/want/dragon/to/be
> cvs -d:pserver:anonymous@dragongoserver.cvs.sourceforge.net:/cvsroot/dragongoserver login
> cvs -z3 -d:pserver:anonymous@dragongoserver.cvs.sourceforge.net:/cvsroot/dragongoserver co DragonGoServer
> mv DragonGoServer/* DragonGoServer/.[a-z]* .
> rmdir DragonGoServer

or download a cvs snapshot from <http://www.dragongoserver.net/snapshot.php>


For both methods also download the images and translation-data
from <http://www.dragongoserver.net/snapshot.php>

Those files have to be unzipped in the dragon root directory to obtain a tree like:
      /root
         /include
         /forum
         ...
         /images
            /flags
         /5
         /7
         ...
         /50
         index.php
         status.php
         ...

Copy /images/favicon.ico into the root folder (or place your own favicon.ico
in the root folder).




2) Make a mysql database and a mysql user to access the database:

mysql> CREATE DATABASE dragondb;
mysql> GRANT select, insert, update, delete ON dragondb.* TO dragon@localhost IDENTIFIED BY 'secret';




3) Create mysql tables:

> mysql -D dragondb < init.mysql
(( or maybe, if needed by your configuration, the more complete:
> mysql -D dragondb -h mysqlhost -u username -p password < init.mysql
))

and add some translations (the data file can be downloaded
from <http://www.dragongoserver.net/snapshot.php>
and then unzipped ):

> gunzip Translationdata.mysql.gz
> mysql -D dragondb < Translationdata.mysql


(( This could be delayed until you need it:
Add at least one admin user then give him the full set of priviledges
by manually setting his Adminlevel field to -1 in the Players table.

> mysql -D dragondb

mysql> UPDATE Players SET Adminlevel=-1 WHERE Handle='usernick';

Then, this user will be able to manage the other admins.
))




4) Adjust config of software and adjust file permissions:

* Edit permissions for include/config.php and directory translations/:

Find which group your webserver is using (e.g. www-data).
> su -c 'chgrp www-data include/config.php translations'
> chmod 640 include/config.php
> chmod 775 translations/


* To create translations take a sidestep and read
  scripts/README.translations


* If you want to adjust the source-code, please have a look to the
  notes in scripts/README.developers


* Adjust include/config.php to your environment.


* PHP config:

By now, Dragon works with these PHP directives:
 allow_call_time_pass_reference = Off ;Unused
 allow_url_fopen = Off ;Unused
 always_populate_raw_post_data = Off ;Unused
 arg_separator.input = &
 arg_separator.output = "&amp;" ;or = "&"
 asp_tags = Off ;Unused
 default_charset = ;set to empty or commented
 default_mimetype = "text/html"
 error_reporting = E_ALL
 file_uploads = On ;else the pattern upload will be disabled
 gpc_order = GPC
 implicit_flush = Off ;Unused
 magic_quotes_gpc = Off ;Don't care
 magic_quotes_runtime = Off
 magic_quotes_sybase = Off
 max_execution_time = 30 ;except for some rebuilding scripts with large databases
 memory_limit = 8M
 output_buffering = Off
 post_max_size = 8M ;greater than upload_max_filesize if used
 precision = 14
 register_argc_argv = Off ;Unused
 register_globals = Off ;Don't care
 safe_mode = Off ;else safe_mode_allowed_env_vars= must allow putenv() to modify 'TZ'
;set sendmail_* options to your needs
 short_open_tag = Off ;Unused
 track_vars = On ;always enabled as of PHP 4.0.3
 upload_max_filesize = 2M ;if used
 variables_order = EGPCS ;or empty
[MySQL]
 mysql.allow_persistent = Off ;Unused
 mysql.default_host = ;Unused
 mysql.default_user = ;Unused
 mysql.default_password = ;Unused
 mysql.max_links = -1 ;Unused



* OPTIONAL: for using FreeType-font drawing rating graphs:

Check and adjust defines in 'include/graph.php':
- TTF_PATH
- TTF_NAME
- TTF_HEIGHT




5) Add some cron jobs. These should preferrably be run on a remote machine, so that the
   clock is not running when the network is down.

> crontab -e

# m  h dom mon dow command
*/5  *  *   *   *   wget -q -O - http://your.url/clock_tick.php
0,30 *  *   *   *   wget -q -O - http://your.url/halfhourly_cron.php
25   5  *   *   *   wget -q -O - http://your.url/daily_cron.php


(( Windows NT/200x/XP - some freeware clones of cron may be found on the web ))




6) Protect the scripts/ folder from outside access:
   The scripts/ folder contains sensible tools reserved to the developers
   or the admins team.
   You have to protect it with an authentification process (using, for
   example, the .htaccess AuthUserFile command) or at least move the
   whole folder outside the server root tree when you have used it.




7) Complain in the support forum at dragon <http://www.dragongoserver.net> if it doesn't
   work.

