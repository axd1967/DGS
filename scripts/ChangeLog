------------------------------------------------------------------
General infos
------------------------------------------------------------------
changelog reference at:
http://www.gnu.org/prep/standards/html_node/Change-Logs.html

previous server update: 2006-09
release [2006-08-07] - DGS 1.0.12 - CVS-tag [DGS-stable-200608]


quick INFO:
2007-02-03 rodival
   I've reformatted the changelog file with last changes at top.
   I'm working on the bad centered alignement of FAQ, docs and other pages.

-----
2007-06-26 rodival
   I've executed the DGS player_consistency.php script to fix some
   (near 20) bugged players' infos (see "Running" in this day section)
   I've not found the reason of this bug. Keep an eye on it!
\2007-07-06 rodival
   2 new users with a bad "Running" count have appeared yesterday:
   6415=random_penguin:82.108.171.178, 13628=guerrilla27:83.18.19.250
 uid   cntfix last finished games        last accepted games        ucol
 13628 23=>22 295161 2007-07-05 15:05:05 330544 2007-07-05 15:15:29 W
                                         330461 2007-07-05 11:22:15 W
                                         330485 2007-07-05 10:46:05 W
                                         330467 2007-07-05 08:36:04 W
                                         330442 2007-07-05 04:03:51 W
 6415  14=>13 295161 2007-07-05 15:05:05 330544 2007-07-05 15:15:29 B
   Both users share a finished and an accepted game. Both games accepted by
   "invitation". No waitingroom. No double game. No timeout. Other counts Ok.
   Either in send_message.php, Running=Running+2 instead of +1
   or in confirm.php, a Running=Running-1 not executed => but those for
    the normal ending games are associated with a Finished=Finished+1
   or an invisible game deletion where Running=Running-1 is isolated.
   Found those recent errors:
 ID	Handle	Message	MysqlError	Debug	Date	IP
 3155508	afm	mysql_update_game		conf20(327771)	20070706092914	64.168.66.246
 3154151	Kaichan	mysql_update_game		conf20(322501)	20070706003502	217.230.149.80
 3153922	jalen	internal_error		confirm10	20070705235433	74.73.138.215
 3153353	bornfreerunfree	mysql_update_game		conf20(297448)	20070705203942	213.233.247.132
 3152914	Acnil	mysql_update_game		conf20(315438)	20070705172412	207.45.248.19
 3152886	jean-claude	mysql_update_game		conf20(330341)	20070705171139	194.78.196.244
 3152644	RuderiX	already_played		confirm11	20070705154342	193.238.131.253

 3152540	guerrilla27	receiver_not_found		message_selector.php	20070705150637	83.18.19.250
 3152538	guerrilla27	receiver_not_found		message_selector.php	20070705150605	83.18.19.250
 3148494	guerrilla27	not_your_turn		game.php?gid=298476	20070704102754	83.18.19.250
 0 errors for IP='82.108.171.178'
-----


quick TODO:
------------------------------------------------------------------

------------------------------------------------------------------
Changelog
------------------------------------------------------------------

2007-07-06 rodival

   * confirm.php, quick_play.php:
   - moved the place where the GameNotes are deleted
   - few minor debug messages adjustements (quick_play accordingly)


2007-07-06 rodival

   * admin_faq.php:
   - hidden the info box and added an anchor to show it.
   - adjusted some colspan= of the main table.
   - allowed to edit an item even if hidden.
   - inverted the icon of Hide and Show buttons.


2007-07-05 rodival

   * translate.php, update_translation.php,
     include/make_translationfiles.php (translations_query):
   - modified the 'Untranslated' option (may be applied on every group).
     therefore, added a 'All groups' option.
   - hidden the now big info box and added an anchor to show it.


2007-07-03 rodival

   * translate.php, update_translation.php,
     include/make_translationfiles.php (translations_query):
   - added a filter on the english part.
     added the $filter_en argument to translations_query()

   * INSTALL
   - added a step to protect the scripts/ folder.


2007-07-02 juga

   * show_games.php:
   - added hover-text on colors-column for "my running games"

2007-07-01 juga

   * include/std_functions.php:
   - reverted changes to make_url-func to fix bug

2007-06-30 juga

   * waiting_room.php:
   - changed bottom-link to 'Show all suitable games' to indicate it's a reset


2007-06-30 juga

   * include/filter.php,
     include/filter_functions.php,
     include/filter_parser.php,
     include/std_classes.php,
     include/tokenizer.php,
   * code_examples/filter_example.php,
     code_examples/filter_example2.php,
     code_examples/query_sql.php,
     code_examples/tokenizer_example.php,
   * skins/dragon/screen.css,
   * specs/filters.txt:
   - added classes and functions comprising new Filter-framework
   - added examples for filter-stuff
   - added some CSS for filters
   - added main-doc in specs/filters.txt

   * include/table_columns.php:
   - added searching capabilities on table-columns using Filter-framework
     see specs/filters.txt and code_examples/form_example2.php
   - fixed paging-link-bug preserving form-values with links
   - added maxrows-selection to restrict row-size of table-list

   * include/form_functions.php,
     code_examples/form_example.php,
     code_examples/form_example2.php:
   - added Form-types 'FILTER' and 'FILTERERROR' for Filter-framework
   - added area-group layouting and some additional layout-config
     when used as External-Form with Table(-Filters)
   - added example for area-layouting, allow examples to be opened in browser

   * show_games.php, forum/search.php, users.php, waiting_room.php,
     message.php, status.php:
   - added or extended searching capabilities using filter-framework
   - adjustments for using filters
   - added (recommended) new indexes to support new filters;
     needed space + reasons given as comment:
-----------
ALTER TABLE Games        -- +3 MB (for filter)
 ADD INDEX Handicap (Handicap) ;
ALTER TABLE Games        -- +2 MB (for filter/sort)
 ADD INDEX Moves (Moves) ;
ALTER TABLE Games        -- +3 MB (for filter/sort)
 ADD INDEX Score (Score) ;

ALTER TABLE Posts        -- +0.2 MB (for filter)
 ADD INDEX Parent_ID (Parent_ID) ;
ALTER TABLE Posts        -- +0.2 MB (for filter/sort)
 ADD INDEX Time (Time) ;

ALTER TABLE Players      -- +0.2 MB (for filter)
 ADD INDEX Country (Country) ;
ALTER TABLE Players      -- +0.4 MB (for filter/sort, often changed)
 ADD INDEX Lastaccess (Lastaccess) ;
-----------

   * search_messages.php, list_messages.php,
     include/message_functions.php:
   - added new page for searching messages using filters
   - signature-change of funcs to change layout or highlight search-terms:
     message_list_query/_list_table/_info_table, echo_folder_box
   - signature-change of message_list_table-func adding args to control
     message-list output including fields for message-searching:
     folder, type, Direction, message partner
   - added (mandatory) fulltext-index for search on messages
   - slight modifications of SQL using table-alias and join on
     MessageCorrespondents
-----------
ALTER TABLE Messages     -- ca. +80% of data-size (biggest change)
 ADD FULLTEXT INDEX Subject (Subject,Text) ;
-----------

   * users.php:
   - replaced URL-var 'showall' and page-bottom-link with 'Active'-Table-Filter

   * user_stats.php, userinfo.php, users.php:
   - added new page to show opponents and games-statistics for two players

   * waiting_room.php:
   - added Player-Country-column and Filter on it
   - bugfix: used wrong SQL-field for table-column #1 (name)
   - replaced URL-var 'showall' and page-bottom-link with two Table-Filters
     Suitable-Handicap and Suitable-Rating-Range
   - change page-title reflecting current "suitable"-state
   - re-added page-bottom-links "Show all games" and "Show only suitable
     games" to reset to filter-defaults

   * forum/read.php, forum/search.php,
     forum/forum_functions.php (make_link_array, forum_start_table),
     include/quick_common.php:
   - added order-selectbox in forum-search
   - added support to highlight search-terms in a post or message
   - fixed bug for paging to preserve form- and filter-values
   - fixed bug with relevance when using search-terms in boolean-mode
   - added const DAYS_NEW_END used for forum-reads

   * include/std_functions.php:
   - added some functions and consts to support Filter-framework:
     - support to handle maxrows of table-listing, added funcs
       get_maxrows, build_maxrows_array
     - added allowed HTML-text <term> to support term-highlighting
     - added mark_terms-func to highlight terms within potential XML-text
     - added defaults for Table-Filter-layout
     - adjusted body-width to 90% fixing some strange centric-related layout-
       effects with nested tables (may hopefully get fixed later using CSS)
   - fixed bug in make_url-func only append URI_AMP or '?' if not there,
     added clean_url-func to chop off trailing URI_AMP or '?'
   - changed default-handling of bgcolor for echo_folder_box-func
   - added has_observers-func

   * edit_bio.php:
   - reduce output of bio-texts to 200 chars when changing order

   * site_map.php:
   - added new and search pages

   * game.php:
   - added page-bottom-link to show observers (users.php?observe=<gid>)

   * NEWS, TODO:
   - cleanup some items done

   * INSTALL:
   - move also dot-files like .cvsignore after CVS-checkout

   * scripts/README.developers:
   - added categories and more hints about (surprising) PHP-behaviour
   - don't use filenames with upper-case


2007-06-30 rodival

   * include/std_functions.php, list.php:
   - removed the unused $MaxRowsPerPage global var.

   * include/make_translationfiles.php (translations_query),
   * translate.php, update_translation.php:
   - added a "prev/next" management of the translators' pages.
     added the $from_row argument to translations_query()

   * scripts/README.translations:
   - documenting the "do_it" URL argument of generate_translation_texts.php


2007-06-29 rodival

   * people.php, admin_faq.php:
   - added the info about FAQadmins' activity to "LastUpdate".
-----------
ALTER TABLE `FAQlog`
 ADD `Date` timestamp(14) NOT NULL AFTER `Answer` ;
UPDATE `FAQlog` SET `Date` = '0' ;
-----------

   * translate.php, include/translation_functions.php (language_exists,
   *  T_, get_language_descriptions_translated):
   - case insensitive search of the language name in language_exists().
   - added an automatic cut of the #xxx part of the alternate english words
     in T_().
   - added a $keep_english parameter to get_language_descriptions_translated().
   - changed all $langcode names to the now more accurate $browsercode.

   * include/make_translationfiles.php (translations_query),
   * admin_translators.php, admin_do_translators.php,
   * translate.php, update_translation.php,
   * scripts/generate_translation_texts.php:
   - added the add_text_to_translate function.
   - added the insertion of the new language names in the translation process.
   - added an optional alphabetical sort in translations_query().
   - added a better "T_(...)" template detection using eval() in
     generate_translation_texts.php. Also added a "do_it" URL argument.
   - changed all $langcode names to the now more accurate $browsercode.

   * scripts/update_translation_pages.php (find_php_files):
   - updated the $directories array in find_php_files().
   - added a "Fatal error" - waiting for a fix - in case of a $TranslateGroups
     not found in the database. The bug may come from a typo in the PHP code
     or from a missing row in the database. The default "do_it" action fix
     this last case.


2007-06-28 rodival

   * statistics.php, graph.php, ratingpng.php, statisticspng.php:
   - added the statratingspng.php file which display stats on ratings.
     Minor adjustements of other files to handle it.
     Added the function patterncolor() to graph.php.


2007-06-26 rodival

   * add_to_waitingroom.php, join_waitingroom_game.php, waiting_room.php:
   - fixed the "double game" handicap option from the waitingroom.
     In the waitingroom table, renamed the old "Handicap" column to
     "Colors" and added the new "Handicap" one containing the number
     of handicap stones.
-----------
ALTER TABLE `Waitingroom`
 ADD `Handicap` Handicap int(11) NOT NULL default '0' AFTER `Komi` ;
-----------

   * include/message_functions.php (game_info_table), send_message.php,
   * include/make_game.php:
   - adjusted to follow the "double game" handicap fix and its display.
   - and a try to fix the bad Running count bug:
     In the Players table, near 20 of the Running counts were 1 or 2
     points too hight. I've not found why this occured. Maybe a script
     abort between two MySQL updates, I don't know.
     Other counts like Finished, Won or Lost were not corrupted.


2007-06-25 rodival

   * scripts/data_report.php:
   - implementation of a two steps validation:
     first, just the EXPLAIN, then the full result.
   - differenciation of the NULL values.

   * scripts/data_export.php:
   - including the translations tables export
     and hidding some minor variations.


2007-06-24 rodival

   * scripts/game_consistency.php, include/move.php (check_move):
   - enhanced consistency check.  Added some Time and Rating checks.
     Now, check_move() returns '' if no error or the error message
     (instead of returning false on error and true else).

   * people.php:
   - changed the info about translators' activity to "LastUpdate".


2007-06-03 rodival

   * game.php, confirm.php:
   - fixed the bug: can't deleted a game while PASS or SCORE step entered
     before the delete limit.
     added the GamesNotes deletion to the delete feature.

   * include/std_functions.php (user_reference):
   - because of old DGS users having a pure numeric Handle (not starting
     by a letter), the illegal_chars($player_ref) call had been replaced
     by a simple ereg() comparison here.

   * userinfo.php, users.php:
   - changed the Percent calculus to 100*(Won+Jigo/2)/RatedGames instead
     of the previous 100*Won/RatedGames.


2007-03-27 rodival

   * edit_vacation.php:
   - fixed the bug: adding 2.00 days to 0.25 days gave 2.00 days.
     In fact, when OnVacation was < 1, one can't add but just start vacations.


2007-03-17 rodival

   * confirm.php:
   - added a missing parenthesis.

   * admin_faq.php:
   - adjusting a 'NULL'.


2007-03-01 rodival

   * images/flags/ls.gif:
   - replaced by the new Lesotho flag (old one kept in ls_old.gif)

   * images/forward.gif, images/backward.gif,
   * images/end.gif, images/start.gif,
   * images/plus.gif, images/minus.gif, images/cross.gif:
   - added images


2007-02-04 rodival

   * init.mysql, include/std_functions.php (make_session_code):
   - new MySQL 4.1 behaviour: the PASSWORD() produce a 41-byte hash value
   - modifying Sessioncode in a same spirit
-----------
ALTER TABLE `Players`
 CHANGE `Password` `Password` VARCHAR( 41 ) NOT NULL default '' ,
 CHANGE `Newpassword` `Newpassword` VARCHAR( 41 ) NOT NULL default '' ,
 CHANGE `Sessioncode` `Sessioncode` VARCHAR( 41 ) NOT NULL default '' ;
-----------

   * init.mysql:
   - full periodic check, previous missing update
-----------
ALTER TABLE `TournamentRound`
 CHANGE `Handicaptype` `HandicapType` int(11) NOT NULL default '0' ;
ALTER TABLE `TranslationGroups`
 CHANGE `Groupname` `Groupname` varchar( 32 ) NOT NULL default '' ;
ALTER TABLE `Translations`
 CHANGE `Text` `Text` blob NOT NULL ;
ALTER TABLE `Adminlog`
 CHANGE `Handle` `Handle` varchar(16) NOT NULL default '' ,
 CHANGE `Message` `Message` text NOT NULL ;
ALTER TABLE `Adminlog`
 ADD `IP` varchar(16) NOT NULL default '' AFTER `Date` ;
ALTER TABLE `FAQ`
 CHANGE `Level` `Level` int(11) NOT NULL default '0' ,
 CHANGE `Question` `Question` int(11) NOT NULL default '0' ,
 CHANGE `Answer` `Answer` int(11) NOT NULL default '0' ;
-----------

   * data_export.php:
   - Create_options management added and CSS adjusted.


2007-02-03 rodival

   * include/graph.php, ratingpng.php, ratinggraph.php:
   - rating graph displayed "by number of games"
     (new X-axis option added to the old "by date of games")
   - complete rebuild of graph.php. Graph class added.
     handling the "bynum" option

   * statisticspng.php, statistics.php:
   - using the new Graph class

   * include/rating.php, include/std_functions.php:
   - small modifications consequently


2007-01-25 rodival

   * include/table_columns.php:
   - enhancements mainly to fix the "button" column min-width
     until CSS min-width is working
   - introduced use of external form (var ExternalForm)
   - added funcs: set_default_sort(), get_arg()

   * include/std_functions.php (split_url, yesno, modf & more),
   * include/message_functions.php:
   - added funcs
   - adaptations for enhanced Table_Info class, "button" columns and
     common to waitingroom and message

   * edit_bio.php,
   * list_messages.php,
   * message.php,
   * show_games.php,
   * skins/dragon/screen.css,
   * status.php,
   * userinfo.php,
   * waiting_room.php:
   - using new Table_Info class properties, for games infos and
     common to waitingroom and message

   * NEWS, news.php, skins/dragon/screen.css:
   - adding NEWS file [initally built by JUG] with user-visible changes


2007-01-21 rodival

   * scripts/README.developers, scripts/CHANGELOG.developers, CHANGELOG:
   - added info files


2007-01-12 rodival

   * include/connect2mysql.php (mysql_addslashes) + most of the other
   * files (used nearly everywhere):
   - generalization of the right MySQL addslashes feature,
     introducing function to properly escape value in SQL-statements

   * do_registration.php:
   - rejection of some account usurpers

   * whole set of forum files/functions using table 'Posts.PosIndex':
   - changed 'Posts.PosIndex' to NOT NULL
-----------
ALTER TABLE `Posts`
 CHANGE `PosIndex` `PosIndex` varchar(80) binary NOT NULL default '' ;
-----------

   - removing NULL fields
     the Posts.crc32 int(11) default NULL, seems to be
     kept (while not yet used)
-----------
ALTER TABLE `Players`
 CHANGE `IP` `IP` varchar(16) NOT NULL default '' ;

ALTER TABLE `Posts`
 CHANGE `Time` `Time` datetime NOT NULL default '0000-00-00 00:00:00' ,
 CHANGE `Lastchanged` `Lastchanged` datetime NOT NULL default '0000-00-00 00:00:00' ,
 CHANGE `Lastedited` `Lastedited` datetime NOT NULL default '0000-00-00 00:00:00' ,
 CHANGE `LastPost` `LastPost` int(11) NOT NULL DEFAULT 0 ,
 CHANGE `Subject` `Subject` varchar(80) NOT NULL default '' ,
 CHANGE `Text` `Text` text NOT NULL ,
 CHANGE `User_ID` `User_ID` int(11) NOT NULL DEFAULT 0 ,
 CHANGE `Parent_ID` `Parent_ID` int(11) NOT NULL DEFAULT 0 ,
 CHANGE `PostsInThread` `PostsInThread` int(11) NOT NULL DEFAULT 0 ,
 CHANGE `old_ID` `old_ID` int(11) NOT NULL DEFAULT 0 ;
-----------

   * include/table_infos.php:
   - enhanced Table_Info class to handle waiting_room particularities and
     games info
   - changed syntax of row/column-description (properties)

   * waiting_room.php,
   * userinfo.php,
   * edit_bio.php,
   * status.php,
   - using the new Table_infos class properties

   * skins/dragon/screen.css
   - to follow the Table_infos modifications


2007-01-10 rodival

   * include/table_infos.php:
   - adding class Table_infos for more CSS friendship

   * userinfo.php, edit_bio.php, status.php:
   - using class Table_infos


2007-01-09 rodival

   * change_bio.php, edit_bio.php: [from code mailing of JUG]
   - adding the "bio infos order" feature
   - removing NULL fields
-----------
ALTER TABLE `Bio`
 ADD `SortOrder` INT( 11 ) DEFAULT 0 NOT NULL AFTER `Text` ;

ALTER TABLE `Bio`
 CHANGE `Category` `Category` VARCHAR( 40 ) NOT NULL DEFAULT '' ,
 CHANGE `Text` `Text` TEXT NOT NULL DEFAULT '' ;
-----------


2006-12-29 rodival

   * include/std_functions.php (verify_email) + all callers:
   - adjusted error signature and error behaviour


2006-12-28 rodival

   * init.mysql:
   - removing NULL fields in database
   - added 'RESULT' to enum Messages.Type for a futur message chain walking
     throught the game comments. The 'RESULT' messages are those send at
     the end of a game.
-----------
ALTER TABLE `Messages`
 CHANGE `Type` `Type` ENUM( 'NORMAL', 'INVITATION', 'ACCEPTED', 'DECLINED', 'DELETED', 'DISPUTED', 'RESULT' ) DEFAULT 'NORMAL' NOT NULL ,
 CHANGE `ReplyTo` `ReplyTo` INT( 11 ) DEFAULT 0 NOT NULL ,
 CHANGE `Game_ID` `Game_ID` INT( 11 ) DEFAULT 0 NOT NULL ,
 CHANGE `Time` `Time` DATETIME DEFAULT '0000-00-00 00:00:00' NOT NULL ,
 CHANGE `Subject` `Subject` VARCHAR( 80 ) DEFAULT '' NOT NULL ,
 CHANGE `Text` `Text` TEXT NOT NULL ;

ALTER TABLE `MessageCorrespondents`
 CHANGE `uid` `uid` INT( 11 ) DEFAULT 0 NOT NULL ,
 CHANGE `mid` `mid` INT( 11 ) DEFAULT 0 NOT NULL ;
-----------

   * include/time_functions.php (echo_time_remaining) + all callers:
   - fix bad display of JAP byoyomi when byoyomi reached
     ( "--- + 3 periods of 4h" instead of "4h + 3 periods of 1d" )

   * include/std_functions.php (mysql_single_fetch) + all callers:
   - force to use $debugmsg with mysql_single_fetch()


2006-12-27 rodival

   * images/flags/__.gif:
   - resizing

   * images/flags/eu.gif:
   - added, though not enabled in countries.php


2006-12-23 rodival

   * init.mysql:
   - added skinname
-----------
ALTER TABLE `Players`
 ADD `SkinName` VARCHAR( 32 ) DEFAULT '' NOT NULL AFTER `OnVacation` ;
-----------

   * skins/,
   * skins/index.php,
   * skins/known_skins.php,
   * skins/dragon/index.php,
   * skins/dragon/screen.css,
   * skins/dragon/print.css:
   - added CSS files for skins

   * include/std_functions.php (start_page) + all callers:
   - use of skins

   * sgf.php:
   - score 0 for Jigo


-----------
