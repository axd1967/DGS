------------------------------------------------------------------
General infos
------------------------------------------------------------------
changelog reference at:
http://www.gnu.org/prep/standards/html_node/Change-Logs.html

previous server update:
Release [2014-07-30] - DGS 1.0.18 - tag [release-1_0_18-20140730] on (later) branch [DGS-stable-20140730]

------------------------------------------------------------------
ChangeLog
------------------------------------------------------------------

2014-12-26 jug

   * include/std_functions.php (USERFLAG_RATINGGRAPH_BY_GAMES),
     edit_profile.php, ratinggraph.php, NEWS:
   - added customizable setting in user-profile to show rating-graph by-games,
     default is disabled i.e. show by-time

   * opponents.php:
   - bugfix: exclude invitations and MPGs for 'All games'-filter on opponents-page

   * include/classlib_goban.php (MarkupHandlerGoban.parse_igoban):
   - bugfix: displaying text with bad igoban-tag must not redirect to error-page by throwing error()

   * tournaments/edit_participant.php:
   - bugfix: copy user-rating to tournament-rating for COPY_CUSTOM-rating-use-mode
     also on inviting participant by tournament-director

   * tournaments/include/tournament_properties.php (TournamentProperties.checkUserRegistration):
   - bugfix: allow inviting by tournament-director of user violating tournament-registration-checks
     by not returning warning as errors

2014-12-18 jug

   * edit_bio.php:
   - added special URL-argument 'ri' to pre-fill new bio-entry with rank-info for other Go-servers
     to assist in poll to improve rank-converter

2014-11-23 jug

   * tournaments/include/tournament_properties.php (TournamentProperties.__construct, ~.build_seed_order):
   - changed default of RatingUseMode from TPROP_RUMODE_COPY_CUSTOM -> TPROP_RUMODE_CURR_FIX

   * include/classlib_user.php (User.determine_games_next_hero_level),
     include/quick/quick_user.php (QuickHandlerUser.process),
     include/globals.php (DGS_VERSION, QUICK_VERSION),
     specs/quick_suite.txt,
     userinfo.php (build_hero_info):
   - show number of games needed to reach next hero-badge-level on user-info-page
     - only shown for own user-info
     - omitted if already reached golden-hero-badge
     - show that rating and min. number of finished games are needed to get hero-badge
     - show also for quick-suite user-info-handler

   * include/gui_functions.php (span):
   - bugfix: span() needed basic-safe encoding for title-attribute

   * include/classlib_userconfig.php (BOARDFLAG_SUBMIT_MOVE_STAY_GAME),
     include/globals.php (CSS_VERSION),
     specs/db/table-Players.txt,
     skins/dragon/screen.css,
     edit_profile.php (parse_edit_form),
     game.php (draw_message_box),
     confirm.php:
   - added button on game-page to submit-move & reload page with same game
     - button to submit & stay on same game can be enabled with new game-page-setting in user-profile
     - moved 'Message'-box description from left-side to above text-area input-box
     - extended move-message width: 70 -> 80

### ----- release-1_19_0-20141029 -----

2014-10-27 jug

   * tournaments/include/tournament_result_control.php (class TournamentResultControl,
       ~.build_tournament_result_table, ~.make_table_tournament_results),
     tournaments/include/tournament_cache.php (TournamentCache.load_cache_tournament_results):
   - fix bug: tournament-result-TOP10-list on view-tournament-page showed wrong counts
     due to wrong parsing of caching entries
     - table-header shows number of shown entries
     - table-footer shows total found entries

2014-10-26 jug

   * include/globals.php (CSS_VERSION),
     skins/dragon/screen.css, edit_profile.php,
     images/button0.gif, images/button1.gif, images/button2.gif, images/button3.gif,
     images/button4.gif, images/button5.gif, images/button6.gif, images/button7.gif,
     images/button8.png, images/button9.png, images/button10.png:
   - increased width of ID-buttons by 13 pixels for game-IDs >= 1.000.000

   * include/db/bulletin.php (class Bulletin, ~.__construct, ~.setTargetRatingMin, ~.setTargetRatingMax,
       ~.fillEntityData, ~.new_from_row, ~.build_view_query_sql, ~.get_target_types_with_user_rating),
     include/gui_bulletin.php (GuiBulletin.getTargetTypeTextsWithUserRating, ~.hasTargetRatingRange,
       ~.build_view_bulletin, ~.build_target_rating_range),
     tournaments/include/tournament_round_helper.php (TournamentRoundHelper.notify_directors_last_game_finished),
     include/rating.php (getRatingArray),
     include/globals.php (CSS_VERSION),
     scripts/updates/1.19/database_changes.mysql, scripts/updates/1.19/other_changes.txt,
     specs/db/table-Bulletins.txt, specs/db/dragon-ddl.sql, skins/dragon/screen.css,
     admin_rating.php (notify_fix_running_games),
     admin_bulletin.php (parse_edit_form),
     edit_bulletin.php (parse_edit_form)
     list_bulletins.php, view_bulletin.php:
   - added target user rating-range for bulletins with target-type all-users and tournament-participants
     - allow adding bulletin target user rating-range only for admins
     - normal users can edit admin-created-bulletins with rating-range
     - mark target-type on bulletin-list-page if bulletin has target-user rating-range
     - show target user rating-range on viewing single bulletin if set
   - show user-list-handles and target user rating-range on bulletin-user-edit
   - always show target-type on bulletin-user-edit
   - only allow setting target-types tournament-director and tournament-participants on bulletin-user-edit
-----------
-- added target user rating-range for bulletins
ALTER TABLE Bulletin
   ADD TargetRatingMax smallint NOT NULL default '9999' AFTER TargetType,
   ADD TargetRatingMin smallint NOT NULL default '-9999' AFTER TargetType ;
-----------

2014-10-23 jug

   * edit_rating.php:
   - decreased rank-diff to grant rating-change 6k -> 5k

2014-10-22 jug

   * include/game_functions.php (NGO_LASTMOVED_OLD_FIRST, NGO_LASTMOVED_NEW_FIRST;
       NextGameOrder.get_next_game_orders_selection, ~.build_status_games_query, ~.get_next_game_order),
     scripts/updates/1.19/database_changes.mysql, specs/db/table-Players.txt, specs/db/dragon-ddl.sql,
     confirm.php (jump_to_next_game), status.php, NEWS:
   - added sort-order for status-games ordered by last moved (newest first)
     - renamed NGO_LASTMOVED to NGO_LASTMOVED_OLD_FIRST
     - added NGO_LASTMOVED_NEW_FIRST
     - extended & replaced 'Last move' with 'Last Move (old first)' which is also the default
-----------
-- added sort-order 'Last moved (new first)' for status-games-page
ALTER TABLE Players
   MODIFY NextGameOrder enum('LASTMOVED','LASTMOVED_OF','LASTMOVED_NF','MOVES','PRIO','TIMELEFT') NOT NULL default 'LASTMOVED_OF' ;
UPDATE Players
   SET NextGameOrder = 'LASTMOVED_OF' WHERE NextGameOrder = 'LASTMOVED' ;
ALTER TABLE Players
   MODIFY NextGameOrder enum('LASTMOVED_OF','LASTMOVED_NF','MOVES','PRIO','TIMELEFT') NOT NULL default 'LASTMOVED_OF' ;
-----------

   * tournaments/edit_properties.php (parse_edit_form),
     include/classlib_user.php (User.matchRating),
     include/rating.php (read_rating),
     specs/db/table-Tournaments.txt:
   - added more details about min/max-limit of matching a rating-range
     - allow to parse DGS-rank with percentage-part into DGS-rating

   * tournaments/include/tournament_round_status.php (TournamentRoundStatus.check_conditions_round_status_PLAY),
     tournaments/include/tournament_pool_classes.php (PoolSummary.make_table_pool_summary),
     tournaments/roundrobin/edit_pairing.php:
   - fix bug: for single-pooled round-robin-tournament only show mandatory final-step "ALL"-choice
     to start tournament-games
     - added note about mandatory final step using "ALL"-choice to start-games on edit-game-pairing-page
       and tournament-round-status-page to let system implicitly change tournament-round-status
       from PAIR to PLAY after all games could have been checked

2014-10-21 jug

   * tournaments/roundrobin/define_pools.php (make_suggestions_table):
   - fix bugs for define-pool-page: show errors on pool-count & min-pool-size
     - show error for define-pool on pool-count & min-pool-size only for user-choice
       instead of all suggestions
     - show error for define-pool if user-capacity of pool-size/count choice is not enough
       to satisfy count of registered participants
     - preserve original T-director choice for making suggestions on defining-pool parameters

2014-10-20 jug

   * include/make_game.php (make_invite_game_setup_from_url),
     include/message_functions.php (game_settings_form),
     new_game.php (handle_add_game):
   - prevent conventional- and proper handicap-type for shape-games
     - use manual handicap-type nigiri as default for shape-games invitations and waiting-room
     - disable conventional- and proper handicap-type radio-buttons for shape-games

2014-10-19 jug

   * include/board.php (Board.get_last_move_mark_type, ~.draw_board),
     scripts/updates/1.19/other_changes.txt,
     21/bms.gif, 21/wms.gif, 25/bms.gif, 25/wms.gif:
   - added special last-move-marker

   * include/globals.php (DGS_VERSION),
     scripts/updates/<VERSION>/database_changes.mysql,
     scripts/updates/<VERSION>/other_changes.txt,
     scripts/updates/<VERSION>/release.txt,
     scripts/updates/<VERSION>/ChangeLog,
     scripts/updates/1.0.15/fix_game_comments.php,
     scripts/updates/1.0.15/fix_message_thread.php,
     scripts/updates/1.0.16/fix_default_max_handi.php,
     scripts/updates/1.0.16/fix_game_invitations.php,
     scripts/updates/1.0.16/fix_new_game_expert_view.php,
     scripts/updates/1.0.18/fix_hero_ratio.php,
     scripts/index.php, specs/caching.txt, NEWS:
   - changed server versioning scheme: ARCHITECTURE.MAJOR.MINOR -> 1.19.0
     - moved and adjusted files 'scripts/updates/FILE<VERSION>' into 'scripts/updates/<VERSION>/FILE'
       for old versions 1.0.13, 1.0.14, 1.0.15, 1.0.16, 1.0.17, 1.0.18, 1.0.19 (-> 1.19]
     - adjusted scripts and documentation matching new version-specific directories
       - renamed 'database_changes_<VERSION>.mysql' -> '<VERSION>/database_changes.mysql'
       - renamed 'other_changes_<VERSION>.txt' -> '<VERSION>/other_changes.txt'
       - renamed 'roadmap_<VERSION>.txt' -> '<VERSION>/release.txt'
       - renamed 'ChangeLog_<VERSION>' -> '<VERSION>/ChangeLog'
       - renamed 'fix_<SCRIPT>-<VERSION>.php' -> '<VERSION>/fix_<SCRIPT>.php'

   * tournaments/include/tournament_round_helper.php (TournamentRoundHelper.check_tournament_participant_max_games),
     tournaments/include/types/private_round_robin.php (PrivateRoundRobinTournament.__construct),
     tournaments/include/types/public_round_robin.php (PublicRoundRobinTournament.__construct):
   - increase number of max. games per participant in pool for public/private round-robin-tournaments
     - increased number of max. games per participant from 15 to 18 to allow 10 TPs max
       with DOUBLE-round-robin
     - tournament-admin can overwrite max. games per participant, but then also need to change T-status

   * tournaments/include/types/private_round_robin.php (PrivateRoundRobinTournament.createTournament):
   - changed default-title for newly create private-round-robin tournament
     to "user's private mini-tournament (size)"

   * tournaments/include/tournament_rules.php (TournamentRules.update, ~.delete):
   - fix bug: wrong id used for cache-invalidation of TournamentRules-entries

2014-10-13 jug

   * tournaments/include/tournament_template.php (TournamentTemplate.create_default_tournament_director),
     tournaments/include/tournament_template_ladder.php (TournamentTemplateLadder._createTournament),
     tournaments/include/tournament_template_round_robin.php (TournamentTemplateRoundRobin._createTournament):
   - tournament-wizard: add default tournament-director with game-end privilege on creating new tournament

   * tournaments/view_tournament.php:
   - mark only active tournaments as visited, because they would reappear as "new"
     after tournament closed or deleted

   * tournaments/list_tournaments.php:
   - tournament-list: only mark NEW and active tournaments as "new",
     because visits are removed for closed and deleted tournaments

   * tournaments/include/tournament_visit.php (class TournamentVisit, ~.mark_tournament_visited,
       ~.has_visited_tournament, ~.load_tournament_visits, ~.delete_cache_tournament_visits,
       ~.cleanup_tournament_visits, ~.reset_players_tournament_new_count),
     tournaments/include/tournament.php (Tournament.is_active_tournament),
     include/cache_globals.php (CACHE_GRP_TVISIT, $ARR_CACHE_GROUP_NAMES, $ARR_CACHE_GROUP_CLEANUP),
     include/std_functions.php (make_dragon_main_menu, is_logged_in, count_tourney_new),
     include/globals.php (DAYS_RESET_COUNT_TOURNEY_NEW),
     include/dgs_cache.php (DgsCache.cleanup_cache),
     include/config.php  ($DGS_CACHE_GROUPS),
     scripts/updates/database_changes_1_0_19.mysql, scripts/updates/other_changes_1_0_19.txt,
     scripts/player_consistency.php, scripts/data_export.php, skins/dragon/screen.css,
     specs/db/table-Tournaments.txt, specs/db/table-Players.txt,
     specs/db/dragon-ddl.sql, specs/caching.txt,
     tournaments/cron_tournaments.php (run_once_daily),
     tournaments/list_tournaments.php, tournaments/view_tournament.php,
     tournaments/edit_status.php, NEWS:
   - main-menu: added counter for (un-visited) NEW tournaments
     - list-tournament: added column with "new" as indicator of (un-visited) NEW tournaments
       in red-font (for active tournaments) and in grey-font (for inactive tournaments)
     - view-tournament: mark tournament as visited removing "new" indicator from tournament-list
       and reset counter
     - enforce reload of new-tournament-counter if tournament-status changes from active
       to inactive or vice versa
     - auto-refresh of counter in users main-menu after 2 weeks of inactivity on last-access
     - delete old tournament-visits for finished tournaments in tournaments-cron
   - cleanup cache: added parameter to enforce cache-cleanup for DgsCache
-----------
-- added table to store tournament-visits for NEW-counter in main-menu
CREATE TABLE TournamentVisit (
  uid int NOT NULL,
  tid int NOT NULL,
  VisitTime datetime NOT NULL default '0000-00-00 00:00:00',
  PRIMARY KEY (uid,tid),
  KEY (tid)
) ENGINE=MyISAM ;

-- initial fill tournament-participants that joined active tournaments
INSERT IGNORE INTO TournamentVisit (uid,tid,VisitTime)
   SELECT TP.uid, TP.tid, TP.Created
   FROM TournamentParticipant AS TP INNER JOIN Tournament AS T ON T.ID=TP.tid
   WHERE T.Status in ('REG','PAIR','PLAY') ;

-- added counter for new tournaments
ALTER TABLE Players
   ADD CountTourneyNew smallint NOT NULL default '-1' AFTER CountBulletinNew ;
-----------

2014-10-12 jug

   * tournaments/include/tournament_helper.php (TournamentHelper.build_tournament_join_restrictions),
     tournaments/list_tournaments.php, NEWS:
   - list-tournaments: replaced 'RRNG'-restriction with actual restricted rating-range '30k-9d'

2014-10-08 jug

   * include/std_functions.php ($html_code, $html_safe_preg; feature_reference):
   - added DGS-tag <feature id> to reference DGS-feature

2014-10-06 jug

   * include/rank_converter.php (RankConverter.buildForm),
     include/rating.php (convert_to_rating),
     include/globals.php (MAX_ABS_RATING),
     tournaments/edit_participant.php (parse_edit_form),
     tournaments/edit_results.php (parse_edit_form),
     tournaments/register.php (parse_edit_form),
     admin_rating.php, edit_rating.php:
   - fixed bug for max-rating of 10dan allowed to register in tournaments and for rank-converter
     - MAX_START_RATING to set initial rating, or
     - MAX_ABS_RATING for entering existing rating of users

   * include/classlib_userconfig.php (ConfigBoard.set_wood_color),
     include/std_functions.php ($woodbgcolors),
     js/goeditor.js (woodbgcolors),
     specs/db/table-Players.txt, images/smallwood16.gif, edit_profile.php,:
   - added white-wood-background for game-board-display

2014-10-05 jug

   * include/config.php (ALLOW_QUOTING),
     forum/forum_functions.php (DisplayForum.draw_post),
     forum/read.php:
   - re-enabled ALLOW_QUOTING to get access to a forum post's RAW-text
     - enabled ALLOW_QUOTING in 'include/config.php' to show 'quote'-link right
       to 'reply'-link on each forum-post
     - simplified quote-pre-amble to only contain quoted user

   * include/message_functions.php (game_info_table),
     waiting_room.php :
   - for waiting-room added link to finished games with opponent
     - added column for waiting-room-list with table-icon linked to finished games with opponent
     - added table-icon linked to finished games with opponent on viewing single waiting-room-entry

   * snapshot.php:
   - translation-data export must also contain FAQ/Links/Intro-table-data

   * show_games.php:
   - changed order of current-rating-columns by moving current-rating right after user-id
     - for all kind of users: user, opponent, black, white user
     - for all views: my/user finished games, my/user running games, all finished games,
       all observed games, my observing games, all running games

   * include/std_functions.php ($html_code_closed, $html_code, $html_safe_preg):
   - added DGS-tag <bgcolor col>...</bgcolor> to mark text with background-color

   * forum/forum_functions.php (FORUM_MAX_INDENT):
   - increased forum-max-indent level from 15 to 25 as recent discussion went very deep

   * include/std_functions.php ($html_code_closed, $html_code, $html_safe_preg, ticket_reference),
     include/config.php (TICKET_REF), INSTALL:
   - added DGS-tag <ticket issue> to reference issues in external ticket-system
     - external URL to ticket-system can be configured with global config 'TICKET_REF'

   * tournaments/include/types/public_round_robin.php (PublicRoundRobinTournament.createTournament):
   - changed default-title for newly create public-round-robin tournament to
     "user's mini-tournament (size)"

   * scripts/README.developers:
   - added site-policy regarding the use of JavaScript on DGS,
     inspired by https://sourceforge.net/p/dragongoserver/dgs-main/merge-requests/6/

2014-09-14 jug

   * include/sgf_builder.php (SgfBuilder.build_filename_sgf),
     specs/quick_suite.txt:
   - added file-pattern formatting for SGF-download:
     $M = moves-count, $H0 = handicap (with 0), $T = game-type

2014-08-05 jug

   * include/gui_bulletin.php (GuiBulletin.build_view_bulletin):
   - show publish-time of bulletin with weekday and timezone

   * game.php:
   - show territory-markers for all users for game on SCORE|SCORE2-status
     if last move was scoring-step POSX_SCORE

   * include/wroom_control.php (WaitingroomControl.build_waiting_room_query, ~.join_waitingroom_game):
   - bugfix: fixed missing check of waiting-room accept-same-opponent-restriction
     for total-count of joined games
     - sync'ed SQL-clause-parts

