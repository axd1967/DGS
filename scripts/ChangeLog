------------------------------------------------------------------
General infos
------------------------------------------------------------------
changelog reference at:
http://www.gnu.org/prep/standards/html_node/Change-Logs.html

previous server update:
Release [2014-03-27] - DGS 1.0.17 - tag [release-1_0_17-20140327] on branch [DGS-stable-20140327]

------------------------------------------------------------------
ChangeLog
------------------------------------------------------------------

2014-04-18 jug

   * include/db/move_sequence.php (MoveSequence.insert, ~.update, ~.load_cache_last_move_sequence, ~.delete_cache_move_sequence),
     include/cache_globals.php (CACHE_GRP_COND_MOVES, $ARR_CACHE_GROUP_NAMES, $ARR_CACHE_GROUP_CLEANUP, $DGS_CACHE_GROUPS),
     include/game_functions.php (GameHelper._delete_base_game_tables),
     scripts/updates/other_changes_1_0_18.txt,
     specs/caching.txt,
     game.php:
   - added caching for loading conditional-moves move-sequence on game-page
     - invalidate conditional-moves-cache on actions: insert, update, game-deletion
     - bugfix: allow and load conditional-moves on game-page only for players
   - delete conditional-moves on game-deletion

   * include/db/move_sequence.php (MoveSequence.build_query_sql, ~.load_last_move_sequence,
       ~.load_last_move_sequences),
     include/conditional_moves.php (ConditionalMoves.get_nodes_start_move_sgf_coords),
     game.php (draw_conditional_moves_links, handle_conditional_moves, draw_conditional_moves_input):
   - added show-mode and saving in edit-mode for conditional-moves
     - disable edit-elements in show-mode, but allow previewing of variations

   * include/form_functions.php (Form.print_insert_textarea, ~.print_insert_submit_buttonx):
   - added additional attributes for printing textarea-element and default empty-attributes
     for print_insert_submit_buttonx()

   * include/conditional_moves.php (ConditionalMoves.extract_variation,
       ~.add_played_conditional_moves_on_board),
     include/board.php (class Board, ~.set_conditional_moves, ~.has_conditional_moves,
       ~.set_conditional_moves, ~.move_marks, ~.draw_captures_box),
     game.php (handle_conditional_moves):
   - show preview of specific variation of conditional-moves on game-board
     - extract specific variaton from conditional-moves entered for previewing
     - add moves and captures from conditional-moves with move-numbering starting with 1

2014-04-17 jug

   * game.php (handle_conditional_moves, draw_conditional_moves_input):
   - split handling and GUI-drawing for conditional-moves to prepare
     for showing variation-preview on board

   * include/sgf_parser.php (SgfParser.parse_sgf_game_tree, ~.sgf_parse_node, ~.push_var_stack;
       class SgfNode, ~.__construct, ~.get_props_text),
     include/conditional_moves.php (ConditionalMoves.reformat_to_sgf, check_nodes_cond_moves),
     include/coords.php (is_valid_sgf_coords, is_valid_board_coords),
     scripts/tests/GeneralFunctionsTest.php (GeneralFunctionsTest.test_is_valid_sgf_coords,
       ~.test_is_valid_board_coords),
     game.php (draw_conditional_moves_input):
   - check syntax of conditional-moves and extract variation-names SGF-file-upload or manually entered
     - forbid empty variation
     - all variations must start with opponents move, except for root-node
     - forbid move "outside" i.e. after variation
     - each node must have Black or White move, but not both, and must have alternating colors
     - allow SGF- and board-coordinates, but forbid invalid coordinates outside board-limits
     - forbid move after two consecutive passes
     - variations must have at least 2 moves and end with own move-color
     - restrict conditional-moves total size to 2048 bytes
     - replace PASS-move with 'tt'-notation to ''
   - extract variation-references on conditional-moves-syntax-check like '1.2' for variation-preview
   - re-build and re-parse conditional-moves part from SGF-file for manual input-box for conditional-moves
   - changes to SGF-parsing:
     - store parsing-position for nodes for reference in errors
     - simplify node-tree on parsing SGF-data if only one variation with empty root-node
       if root-node skipped
     - bugfix SgfParser::push_var_stack(): do not push double var-reference on stack
   - changes to reformatting conditional-moves into SGF-like format:
     - bugfix: do not remove LFs from manually entered conditional-moves, but remove double spaces
     - use optimized regex-matching "//S"

2014-04-16 jug

   * include/sgf_parser.php (SgfParser.sgf_parser; class GameSgfParser, ~.__construct, ~.get_error,
       ~.verify_game_attributes, ~.verify_game_shape_setup, ~.verify_game_moves, ~.parse_sgf_game),
     include/conditional_moves.php (ConditionalMoves.load_cond_moves_from_sgf),
     include/game_sgf_control.php (GameSgfControl.verify_game_sgf),
     include/board.php (Board.prepare_verify_game_sgf),
     game.php (draw_conditional_moves_input),
     goban_editor.php (load_igoban_from_sgf):
   - adjusted SGF-game-verification from attaching-SGF to be re-used for parsing and
     checking uploaded SGF with conditional-moves
     - added SGF-game-verification for uploaded conditional-moves from SGF on identical
       game-attributes, shape-setup and played moves
     - added option to enable checking PASS-moves on SGF-game-verification
     - identify start of conditional-moves in uploaded SGF
     - refactored GameSgfControl::prepare_verify_game_sgf() into Board-class to be re-used for
       parsing and checking uploaded SGF with conditional-moves
     - refactored checking of game-attributes, shape-setup and played moves from GameSgfControl-class
       into GameSgfParser-class
     - convert SGF PASS-notation with B/W[tt] for board-size <= 19 to standard B/W[]
     - bugfix for GameSgfParser.parse_sgf_game(): parse certain game-attribute SGF-properties
       only in root-node
   - bugfix goban-editor: also show SGF-parsing errors on uploading shape from SGF

2014-04-14 jug

   * include/std_functions.php, game.php:
   - cleanup: get rid of $has_sgf_alias to use URL 'game123.sgf' to download SGF
     with Apache AliasMatch-config

   * include/std_functions.php, ratinggraph.php, ratingpng.php (interpolate):
   - cleanup: removed switch GRAPH_RATING_BY_NUM_ENABLED to disable the "by number of games"
     rating-graph with just being available

   * include/sgf_parser.php, include/make_game.php:
   - cleanup: get rid of conditional-code-includes for ENABLE_STDHANDICAP

   * include/db/move_sequence.php (class MoveSequence, ~.__construct, ~.setStatus, ~.persist,
       ~.insert, ~.update, ~.fillEntityData, ~.build_query_sql, ~.new_from_row),
     include/conditional_moves.php (class ConditionalMoves, ~.load_cond_moves_from_sgf,
       ~.reformat_to_sgf),
     include/globals.php (CSS_VERSION, MSEQ_STATUS_...),
     include/config.php (ALLOW_CONDITIONAL_MOVES),
     scripts/updates/database_changes_1_0_18.mysql, scripts/updates/other_changes_1_0_18.txt,
     specs/db/table-Games.txt, specs/db/dragon-ddl.sql,
     skins/dragon/screen.css, NEWS,
     game.php (draw_conditional_moves_links, draw_conditional_moves_input):
   - adjusted GUI of game-page to add conditional-moves by uploading from SGF or entering manually
     - game-page: reformat manually entered conditional-moves into SGF-like format
     - added MoveSequence-table and persistence-class to store conditional-moves
     - added server-config ALLOW_CONDITIONAL_MOVES to enable or disable conditional-moves
-----------
-- added table to store conditional-moves
CREATE TABLE MoveSequence (
  ID int NOT NULL auto_increment,
  gid int NOT NULL,
  uid int NOT NULL,
  Status enum('INACTIVE','ACTIVE','ILLEGAL','OPP_MSG','DEVIATED','DONE') NOT NULL default 'INACTIVE',
  Flags tinyint unsigned NOT NULL default '0',
  StartMoveNr smallint unsigned NOT NULL default '0',
  StartMove char(2) NOT NULL default '',
  LastMoveNr smallint unsigned NOT NULL default '0',
  LastMovePos smallint unsigned NOT NULL default '0',
  LastMove char(2) NOT NULL default '',
  Sequence varbinary(2048) NOT NULL default '',
  PRIMARY KEY (ID),
  KEY gid_uid_status (gid,uid,Status)
) ENGINE=MyISAM ;
-----------

   * include/classlib_upload.php (FileUpload.load_data_from_file),
     goban_editor.php (load_igoban_from_sgf):
   - cleanup: refactored loading simple-text from uploaded-file into FileUpload::load_data_from_file()

   * include/sgf_parser.php (SGFP_OPT_SKIP_ROOT_NODE;
       class SgfParser, ~.__construct, ~.parse_sgf, ~.parse_sgf_game_tree, ~.sgf_parse_node,
         ~.sgf_parser, ~.sgf_builder;
       class SgfNode;
       class GameSgfParser, ~.parse_sgf_game; get_handicap_pattern),
     include/game_sgf_control.php (GameSgfControl.verify_game_sgf),
     include/globals.php (SGF_MAXSIZE_UPLOAD),
     goban_editor.php (load_igoban_from_sgf, create_igoban_from_parsed_sgf),
     manage_sgf.php:
   - cleanup & prepare for parsing conditional moves:
     - added option to skip parsing of SGF-root-node
     - SGF-parsing: replace node-array with properties with SgfNode-object with props-array
       for later storing parsing position
     - detailed syntax-error on parsing SGF-part for game-tree or sub-node
     - renamed Sgf-class -> SgfParser-class
     - renamed SgfParser.parse_sgf_tree() -> .parse_sgf_game_tree()
     - renamed GameSgfParser::parse_sgf_data() -> .parse_sgf_game() to avoid function-name-clashes
     - renamed vars to reflect name of set class-instance
     - moved const SGF_MAXSIZE_UPLOAD to common include

2014-04-12 jug

   * include/sgf_parser.php (class Sgf, ~.sgf_parser, ~.sgf_builder, ~.sgf_var_push, ~.sgf_skip_space,
       ~.sgf_parse_node, ~.sgf_parse_args, ~.sgf_parse_key, ~.push_var_stack;
       GameSgfParser.parse_sgf;
       get_handicap_pattern)
     goban_editor.php:
   - cleanup: refactored local SGF-parsing functions into Sgf-class
     - replaced deprecated string-index access s{i} with s[i]
     - refactored constant data into static data
     - adjusted for DGS-layout
     - moved get_handicap_pattern()-function after classes
     - added function-comments

2014-04-11 jug

   * include/game_sgf_control.php (GameSgfControl.verify_game_sgf),
     include/sgf_parser.php (class GameSgfParser),
     goban_editor.php (load_igoban_from_sgf):
   - renamed class SgfParser to GameSgfParser to free class-name

   * tournaments/list_tournaments.php:
   - tournament-list: show directoring tournaments also for tournament-owner and including NEW-status

2014-04-10 jug

   * scripts/updates/database_changes_1_0_13.mysql, scripts/updates/database_changes_1_0_14.mysql,
     scripts/updates/database_changes_1_0_15.mysql, scripts/updates/database_changes_1_0_16.mysql,
     scripts/updates/database_changes_1_0_17.mysql,
     scripts/updates/other_changes_1_0_13.txt, scripts/updates/other_changes_1_0_15.txt,
     scripts/updates/other_changes_1_0_16.txt, scripts/updates/other_changes_1_0_17.txt,
     scripts/updates/roadmap_1_0_13.txt, scripts/updates/roadmap_1_0_14.txt,
     scripts/updates/roadmap_1_0_15.txt, scripts/updates/roadmap_1_0_16.txt,
     scripts/updates/roadmap_1_0_17.txt:
   - simplified naming-scheme for release-files with db- & other-changes & roadmap-files

