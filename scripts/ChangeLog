------------------------------------------------------------------
General infos
------------------------------------------------------------------
changelog reference at:
http://www.gnu.org/prep/standards/html_node/Change-Logs.html

previous server update:
Release [2012-06-08] - DGS 1.0.15 - CVS-tag [DGS-stable-20120608] on branch [DGS-stable-201206]

Developers INFO:

2012-06-07 juga
   Tournaments, Quick-Suite, Game-Editor

2007-12-23 rodival
   Code Cleanup, New Features

------------------------------------------------------------------
ChangeLog
------------------------------------------------------------------

### ----- release-1_0_15-20120608 -----
2012-07-04 juga

   * include/message_functions.php (game_settings_form, game_info_table),
     include/make_game.php (accept_invite_game),
     message.php:
   - fix bug: use opponents jigo-mode for view/dispute of invitation with fair-komi sent to me,
     but using my jigo-mode viewing invitation sent by me

   * game_rematch.php:
   - fix bug: Correct handicap-type if stored GameSetup is not from logged-in user
     for player or non-player, in which case the fix-color and divide&choose fair-komi
     needed compensation

   * include/game_functions.php (GameSetup.get_htype_swapped, ~.determine_handicaptype;
       get_handicaptype_for_invite),
     include/message_functions.php (game_settings_form, game_info_table),
     include/make_game.php (make_invite_game, accept_invite_game),
     include/quick/quick_message.php (QuickHandlerMessage.process_cmd_info),
     scripts/updates/database_changes_1_0_14_to_1_0_15.mysql:
   - fix bug: wrong color chosen on accepting game-invitation and shown for viewing-invitation
     and on dispute, had to take swapped handicap-type of opponennts choice
   - fix bug: handle non-migrated old game-invitations with fix-color-setting stored with Games.ToMove_ID>0,
     then determine color from Games.Black/White_ID
   - write Games.Starttime to indicate start of invitation
-----------
-- fix Starttime for invitations
UPDATE Games
   SET Starttime=Lastchanged WHERE Status='INVITED' AND Starttime=0 ;
-----------

2012-07-03 juga

   * include/classlib_game.php (GameSnapshot.init_game_snapshot),
     include/make_game.php (create_game):
   - set Games.SnapShot also for empty boards

2012-07-02 juga

   * send_new_password.phpA:
   - fix bug: must allow sending-password for not-logged-in users

   * include/make_game.php (accept_invite_game),
     include/message_functions.php (game_info_table),
     include/wroom_control.php (WaitingroomControl.join_waitingroom_game),
     tournaments/include/tournament_rules.php (TournamentRules.prepare_create_game_row),
     waiting_room.php (determine_color):
   - fix bug: show nigiri-color-icon for even-game with conventional-handicap-setting

   * include/game_functions.php (GameNotify.get_text_game_result;
       build_suggestion_shortinfo, get_colortext_probable):
   - fix bug: do not send players final private message in game-end-message to observers,
     but include if there are hidden comments
   - fix bug: show nigiri-color-icon for even-game with conventional-handicap-setting

   * include/rating.php (suggest_conventional):
   - fix bug: revert handicap and komi calculations for conventional-handicap game-setting
     by using nigiri on even game with rating-diff < 0.5 instead of only on exactly same rating
     and correcting handicap-stone from 1 to 0 only for handicap-games

   * include/connect2mysql.php (writeIpStats),
     scripts/updates/database_changes_1_0_14_to_1_0_15.mysql,
     specs/db/dragon-ddl.sql:
   - added creation-date for cleanup of IpStats-table
-----------
-- add creation-date for cleanup
ALTER TABLE IpStats
   ADD Created datetime NOT NULL default '0000-00-00 00:00:00' AFTER Counter,
   ADD KEY Created (Created) ;
-----------

2012-06-23 juga

   * message.php:
   - added Shapes-link on SendMsg-page for invitation-related messages

   * forum/forum_functions.php (DisplayForum.draw_overview, ~.to_string),
     include/utilities.php (cut_str):
   - fix bug: do not cut HTML-entities in two

   * include/globals.php (DASH_SPACING),
     forum/forum_functions.php (ForumThread.get_thread_hits),
     forum/read.php:
   - show thread-hits on thread-posts-view

   * include/game_functions.php (adjust_handicap):
   - fix bug for adjusting handicap: replace handicap of 1 stone with 0 stones

   * templates.php (check_save_template):
   - when replacing existing template the name is taken from the existing template
     if not given to rename

   * include/game_functions.php (parse_waiting_room_rating_range, append_form_add_waiting_room_game),
     new_game.php (handle_add_game):
   - fix bug saving new-game-template with required rating-range:
     - restricting min/max-rating when saving as and reading from template
     - don't adjust min/max-rating by half a rank when saving as template
-----------
# fix existing Profiles (Type=29) by rounding to 100-value for min/max-rating limits
-----------

   * include/sgf_builder.php (class SgfBuilder, ~.echo_sgf, ~.sgf_echo_prop, ~.sgf_echo_comment,
       ~.build_sgf_start, ~.build_sgf_moves, ~.build_sgf_result, ~.build_sgf_end):
   - fix bug: omit double empty comment-property C[]

   * include/gui_bulletin.php (GuiBulletin.check_expiretime),
     include/db/bulletin.php (Bulletin.is_user_bulletin),
     admin_bulletin.php (parse_edit_form),
     edit_bulletin.php (parse_edit_form),
     specs/db/table-Bulletins.txt:
   - fix bug: expire-time for admin-bulletin is optional, but mandatory for user-bulletin
   - reduced min. subject-length: 8 -> 4

   * show_games.php:
   - fix bug for user's finished games:
     opponent- and user-rating-diff were switched using the wrong SQL

   * game.php (draw_game_info):
   - fix bug for MP-game:
     - show hidden-comments to player of a particular move with move-message
     - hide hidden-comments to others

   * game_players.php (check_invite):
   - fix bug for MP-game: handle as error when empty user-handle is used for invitation

   * include/game_functions.php (MultiPlayerGame.init_multi_player_game,
       ~.join_waitingroom_game, ~.load_master_uid):
   - clear QST-cache (quick-status) for MP-games on writing-operations:
     start MP-game, join MP-game

   * show_games.php:
   - typo in bottom-links: Users -> User's
-----------
# recreate translations with translation-scripts
-----------

   * scripts/updates/database_changes_1_0_14_to_1_0_15.mysql:
-----------
-- rename users with spaces in Handle: 1. find them, 2. contact them, 3. rename Handle via user-admin-page
SELECT ID, Handle, Email, Lastaccess, Running, LastMove
   FROM Players WHERE Handle LIKE '% %' ORDER BY Lastaccess ;
-----------

2012-06-17 juga

   * admin.php, admin_admins.php, admin_faq.php, admin_game.php, admin_password.php,
     admin_rating.php, admin_show_adminlog.php, admin_show_errorlog.php, admin_show_faqlog.php,
     admin_show_users.php, admin_translators.php, admin_users.php, translate.php,
     forum/admin.php, forum/admin_show_forumlog.php,
     scripts/fix_game_snapshot.php, scripts/README.developers:
   - reverted translations for admin-pages to strip-off '#'-suffix in texts

   * include/classlib_game.php (NextGameOrder.persist_game_priority),
     include/game_functions.php (GameHelper.delete_running_game; GameFinalizer.finish_game),
     include/message_functions.php (update_count_message_new),
     include/std_functions.php (send_message, clear_cache_quick_status),
     include/db/bulletin.php (Bulletin.mark_bulletin_as_read),
     include/quick/quick_game.php (QuickHandlerGame.process_cmd_play),
     include/globals.php (QST_CACHE_...),
     include/make_game.php (create_game),
     game_players.php (accept_invite, reject_invite, start_multi_player_game),
     clock_tick.php (handle_game_timeouts),
     confirm.php (do_komi_save),
     admin_game.php, quick_play.php:
   - clear QST-cache (quick-status) on some writing-operations for:
     - operations are covered by all interfaces: web-site, quick-play and quick-do-suite
     - appending "CLEAR block" (block = B/M/G/MPG) to existing QST-cache-file will invalidate
       block-specific cache-portion and reload the specific block when quick-status is used

     - "CLEAR G" for status-games on:
       - start a game by joining waiting-room-game or accepting invitation or started MP-game
       - finish a running game by user or timeout
       - delete a running game by user or admin
       - move in a running game (play, resign, delete, pass, score)
       - save change during fair-komi negotation
       - changing the game-priority for ordering status-games
     - "CLEAR M" for private-messages on:
       - new message of single and bulk type for sender and receivers
       - read message (moving it away from NEW-folder)
       - move message into different folder
     - "CLEAR B" for bulletins on:
       - mark bulletin as read
     - "CLEAR MPG" for multi-player-games on:
       - accept or reject invitation
       - start MP-game

   * quick_status.php (append_data, print_bulletins, print_messages, print_status_games,
       print_mpg, parse_cache_content),
     specs/quick_suite.txt:
   - clear QST-cache (quick-status) on some writing-operations:
     - changed cache-filename for quick-status using Players.ID instead of Handle for easier clearing of cache,
     - execute authentication & authorisation before accessing cache-file to ensure correct user-id for script
     - invalidate block-specific cache if "CLEAR block"-instruction found in user-specific QST-cache-file
     - appending "CLEAR block" (block = B/M/G/MPG) to existing QST-cache-file will invalidate block-specific
       cache-portion and reload the specific block when quick-status is used
     - 'excessive_usage'-warning is only given if cache-portions are not invalidated and quick-status called
       again before 1 minute passed since last usage, in which case the full cache-data is returned
     - writing IpStats-table with page-key 'QSTC' for request that returns only cached data,
       'QST' if data is loaded
     - clear datablocks before loading new block-specific data
   - minor cleanup: renamed CACHE_* const to QST_CACHE_* for global-use, moved local funcs to bottom
-----------
# delete existing QST-cache-files: execute 'scripts/clear_datastore.php?subdir=qst&del=1'
-----------

   * game_players.php (build_game_settings):
   - overlooked texts for translation
-----------
# recreate translations with translation-scripts
-----------

   * forum/forum_functions.php (ForumPost.build_query_sql), forum/search.php:
   - fix bug: fixed forum-posts ordered by modification-date using MAX(Posts.Time,Posts.Lastedited),
     former order by Posts.Lastchanged was only date of threads

2012-06-16 juga

   * quick_play.php, scripts/updates/database_changes_1_0_14_to_1_0_15.mysql:
   - set Players.LastQuickAccess if submitting move with quick-play-page
-----------
-- fix Players.LastQuickAccess if LastMove > Lastaccess
SELECT ID, Handle, LastQuickAccess, Lastaccess, LastMove, TIMEDIFF(Lastaccess,LastMove) AS TDiff, TIME_TO_SEC(timediff(Lastaccess,LastMove)) AS TSec
   FROM Players WHERE LastMove >0 AND LastQuickAccess < LastMove HAVING TSec < 0 ;
UPDATE Players
   SET LastQuickAccess = LastMove WHERE LastMove >0 AND LastQuickAccess < LastMove AND TIME_TO_SEC(TIMEDIFF(Lastaccess,LastMove)) < 0 ;
-----------

   * game.php (draw_message_box), confirm.php, NEWS:
   - restored old way for game-submit-move to next-game / to status-page, removed stay-on-board option
   - widened game move-message-box: 60 -> 70

   * features/vote_feature.php:
   - show reason for user if and why voting is not possible

   * admin_admins.php, admin_do_translators.php, admin_faq.php, admin_game.php, admin_password.php,
     admin_rating.php, admin_show_adminlog.php, admin_show_errorlog.php, admin_show_faqlog.php,
     admin_show_users.php, admin_translators.php, admin_users.php, translate.php, update_translation.php,
     forum/admin.php, forum/admin_show_forumlog.php, scripts/check_block_ip.php,
     scripts/clear_datastore.php, scripts/convert_from_old_forum.php, scripts/convert_posindex.php,
     scripts/data_export.php, scripts/data_report.php, scripts/fix_game_snapshot.php,
     scripts/fix_games_timeleft.php, scripts/forum_consistency.php, scripts/game_consistency.php,
     scripts/generate_translation_texts.php, scripts/index.php, scripts/mailtest.php,
     scripts/make_handicap_pattern.php, scripts/message_consistency.php, scripts/player_consistency.php,
     scripts/recalculate_ratings2.php, scripts/server-info.php, scripts/start_frozen_clocks.php,
     scripts/tournament_consistency.php, scripts/translation_consistency.php, scripts/update_translation_pages.php,
     scripts/voting_consistency.php, scripts/obsolete/lang_edit.php,
     scripts/updates/fix_game_comments-1_0_15.php, scripts/updates/fix_message_thread-1_0_15.php:
   - forbid guest-user to use admin-pages by adding additional guest-check

   * include/error_functions.php (need_db_errorlog), specs/quick_suite.txt,
     confirm.php, edit_folders.php, edit_rating.php, edit_vacation.php, game.php, game_players.php,
     join_waitingroom_game.php, new_game.php, old_goban_editor.php, quick_do.php, quick_play.php,
     send_new_password.php, templates.php, tournaments/wizard.php, scripts/README.developers:
   - don't create ErrorLog-entry if guest-user is not allowed to execute operation
   - forbid write-operations by guest-user with 'not_allowed_for_guest'-error
   - forbid usage of some quick-suite-pages by guest-user

   * admin.php, admin_game.php, admin_password.php, admin_rating.php, admin_show_adminlog.php,
     admin_show_errorlog.php, admin_show_faqlog.php, admin_show_users.php, admin_users.php,
     forum/admin.php, forum/admin_show_forumlog.php,
     include/db/ratingchangeadmin.php,
     scripts/fix_game_snapshot.php:
   - removed/commented-out translations for admin-pages
-----------
# recreate translations with translation-scripts
-----------

2012-06-10 juga

   * NEWS:
   - comment out some (disabled) tournament-related features
   - correct game-invitation cleanup: 3 -> 6 months

   * edit_picture.php:
   - added copyright-note for uploading user-picture

   * game.php:
   - fix bug: showed correct user-rating for MP-game on game-page who last-moved
     in players-info-table, was showing rating of logged-in user

   * include/game_functions.php (get_color_titles),
     status.php (load_games_to_move),
     show_games.php:
   - added hover-text on color-images for status-games
   - use nigiri-image for status-games in fair-komi-negotiation
   - fix bug: hover-text about player-to-move of colors-image on my running-games was wrong
   - fix bug: use nigiri-image for games in fair-komi-negotiation

   * include/std_functions.php (user_reference):
   - user-ref: escape user-id/handle in sql

   * include/table_columns.php (Table.make_table_filter):
   - fix bug: removed "Button"-class on <td>-element with table-filter,
     showed button-image-part in some browsers

   * include/time_functions.php (echo_onvacation):
   - fix bug: corrected original text to allow repositioning of words
     in translation of "%s left"-text, e.g. required in Russian language

   * include/utilities.php (basic_safe):
   - fix bug: some browsers (IE) follow the HTML-standard,
     so it doesn't show "&apos;" as apostroph, so replaced with "&#39;"


2012-06-10 juga

   * include/quick_common.php ($clocks_stopped),
     clock_tick.php (clkrng, handle_game_timeouts):
   - added switch $clocks_stopped to stop clocks in 'include/quick_common.php'
     to have a safety-net after some major upgrade

   * include/time_functions.php (get_clock_ticks, time_left_ticksdate),
     include/classlib_game.php (NextGameOrder.make_timeout_date),
     include/game_functions.php (GameHelper.update_clock;
       FairKomiNegotiation.save_komi, ~.start_fairkomi_game),
     include/make_game.php (accept_invite_game, create_game),
     include/quick/quick_game.php (QuickHandlerGame.process_cmd_play),
     tournaments/game_admin.php (draw_add_time),
     confirm.php, game.php, gameinfo.php, quick_play.php:
   - added debug-location for reading clock-ticks

   * game.php:
   - show "other scoring" on devel-server only if game in SCORE-/FINISHED-phase

   * gameinfo.php:
   - removed extra-space for double-game

   * quick_play.php:
   - fix bug: missed X_Black/WhiteClock, so replaced loading with GameHelper::load_game_row()
   - fix bug: missed declaration of $message_query

   * include/make_game.php (accept_invite_game, create_game):
   - fix bug: missed GameSetup on creating double-game when accepting game-invitation

   * scripts/game_consistency.php:
   - fix bug: corrected table-alias usage for unknown column

   * include/db/games.php (Games, ~.insert, ~.update, ~.new_from_row):
   - fix bug: Games.Starttime/Lastchanged are not the typical db-entity
     Created/Lastchanged fields, but start-time after setup & last-moved-date respectively,
     therefore remove auto-setting of Starttime & Lastchanged field in insert() & update()
   - fix bug: used db-entity standard datetime-field prefix -> X_Starttime/X_Lastchanged

   * include/db/waitingroom.php (Waitingroom.insert, update):
   - fix bug: removed non-existing Lastchanged-field

   * scripts/game_consistency.php:
   - commented out & added TODO for wrong datetime-handling for consistency-check
     of Starttime>Lastchanged

   * snapshot.php:
   - updated snapshot-page for release 1.0.15
   - commented out current CVS-version as that version is often not stable

   * scripts/updates/roadmap_1_0_14_to_1_0_15.txt:
   - added mysqldump-command to export translation-data

   * scripts/updates/database_changes_1_0_14_to_1_0_15.mysql,
     scripts/updates/other_changes_1_0_14_to_1_0_15.txt,
     scripts/updates/ChangeLog_1_0_15,
     specs/db/dragon-ddl.sql:
   - sync'ed changes from LIVE-update from 10-Jun-2012
   - sync'ed DDL from LIVE-database
   - fix missing db-update: TournamentLadderProps.ChallengeRangeAbsolute signed

   * include/quick_common.php:
   - disabled server-down with $is_down=false for LIVE-update

   * scripts/fix_game_snapshot.php (fix_single_game, bulk_fix_missing_game_snapshots):
   - fix bug: Games-obj-update() destroyed Starttime/LastChanged-field
   - fix bug: allow single fix also if snapshot not set
   - fix bug: declare global-var for processing ALL games
   - collect game-ids, that coulnd't be processed

2012-06-08 juga

   * scripts/obsolete/*.php, scripts/obsolete/README.txt:
   - found some old scripts on live-server, probably obsolete

   * include/std_functions.php (send_message):
   - bugfix: increase CountMsgNew only if >=0

   * NEWS:
   - prepare release-notes for DGS 1.0.15
     - extended & corrected texts
     - commented out most references to disabled tournaments-features & chinese-ruleset

   * links.php:
   - fix broken links: IGF, IGS

   * include/quick/quick_wroom.php (QuickHandlerWaitingroom.process_cmd_info):
   - comment out TODO-fields: restrictions, calc_type/color/handicap/komi

   * include/config.php (ALLOW_RULESET_CHINESE),
     include/game_functions.php (GameSetupBuilder.build_url_game_basics),
     include/make_game.php (make_invite_game_setup, create_game),
     include/message_functions.php (game_settings_form),
     include/db/games.php (Games.setRuleset),
     tournaments/include/tournament_rules.php (TournamentRules.setRuleset,
       ~.convertEditForm_to_TournamentRules),
     new_game.php, NEWS:
   - disable chinese-ruleset till implementation clarified,
     error or enforce japanese-ruleset as default

2012-06-07 juga

   * include/quick_common.php ($is_down, $is_down_message):
   - sync is_down=true & is_down_message with stable-branch to prepare server-upgrade

   * include/std_functions.php (start_page, show_maintenance_page, is_logged_in),
     include/connect2mysql.php (admin_log, writeIpStats, db_query),
     include/error_functions.php (err_log),
     error.php, game.php, login.php, sgf.php:
   - improve handling if server is down to prevent db-updates and useless db-connections:
     - don't count quota
     - allow login for admins
     - prevent writing AdminLog & ErrorLog
     - db_query: allow only SELECTs, no writing-operations allowed
     - game-page: show maintenance page to prevent useless db-connections
     - sgf: return server_down-error
   - added logging of HTTP-headers for users: Accept-Language & Accept-Charset to support UTF-8 migration

   * scripts/server-info.php:
   - added login-check to allow calling if server-down

   * quick_do.php, quick_play.php, quick_status.php:
   - replace LFs in server-down-message

   * scripts/updates/roadmap_1_0_14_to_1_0_15.txt:
   - roadmap for upgrading to DGS 1.0.15

2012-06-06 juga

   * include/message_functions.php (game_settings_form), NEWS:
   - changed default time-settings: Fischer time 14d+1 -> 30d + 1d

