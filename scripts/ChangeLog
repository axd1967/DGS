------------------------------------------------------------------
General infos
------------------------------------------------------------------
changelog reference at:
http://www.gnu.org/prep/standards/html_node/Change-Logs.html

previous server update:
Release [2012-06-08] - DGS 1.0.15 - CVS-tag [release-1_0_15-20120608] on branch [DGS-stable-20120610]

Developers INFO:

2012-12-06 juga
   Tournaments

------------------------------------------------------------------
ChangeLog
------------------------------------------------------------------

2013-03-31 juga

   * include/quick/quick_message_list.php (class QuickHandlerMessageList, ~.canHandle,
       ~.parseURL, ~.prepare, ~.prepare_filter_answers, ~.prepare_filter_folders,
       ~.check_allow_limit_all, ~.collect_msg_users, ~.process),
     include/message_functions.php (build_folders_all_received; DgsMessage.load_message,
       ~.build_message_base_query),
     include/quick/quick_message.php (class QuickMessage, ~.process_cmd_info, ~.fill_message_info),
     include/quick/quick_suite.php (QuickSuite.getQuickHandler),
     specs/quick_suite.txt, list_messages.php:
   - quick-handler message-object: added 'list'-command with own quick-handler
   - cleanup: added function-modifiers

2013-03-26 juga

   * include/quick/quick_message.php (QuickHandlerMessage.process_cmd_info),
     include/quick/quick_wroom.php (QuickHandlerWaitingroom.fill_wroom_object),
     specs/quick_suite.txt:
   - quick-message info-handler: added handicap- and komi-adjustments
   - quick-waiting-room info-handler: re-arranged handicap- and komi-adjustments
     to match with invitation-info

   * include/board.php (Board.mark_territory):
   - bugfix: wrong count of visited points for seki-mark-check to find non-toggable-points

2013-03-25 juga

   * include/game_functions.php (FairKomiNegotiation.echo_fairkomi_table;
       GameSetup.set_defaults, ~.encode, ~.to_string, ~.format_handicap_type,
         ~.new_from_game_setup, ~.parse_invitation_game_setup, ~.build_invitation_diffs;
       GameSetupChecker.check_komi, ~.check_time, ~.check_adjust_komi, ~.check_min_rated_games,
         ~.check_wroom_count;
       GameSetupBuilder.fill_invite_from_game_setup, ~.fill_new_game_from_game,
         ~.fill_new_game_from_game_setup, ~.build_url_adjustments;
       class GameSettingsCalculator, ~.calculate_settings;
       adjust_handicap, calc_def_max_handicap, get_gamesettings_viewmode,
       append_form_add_waiting_room_game, build_arr_handicap_stones),
     include/message_functions.php (game_settings_form, game_info_table, build_adjust_komi,
       build_adjust_handicap),
     include/wroom_control.php (WaitingroomOffer.calculate_offer_settings),
     include/make_game.php (make_invite_game_setup, create_game),
     include/game_texts.php (GameTexts.get_jigo_modes),
     include/std_functions.php (DEFAULT_MAX_HANDICAP),
     include/globals.php (GSETVIEW_STANDARD),
     tournaments/include/tournament_rules.php (TournamentRules.convertTournamentRules_to_GameRow,
       ~.convertTournamentRules_to_EditForm, ~.convertEditForm_to_TournamentRules),
     tournaments/edit_rules.php (parse_edit_form),
     tournaments/view_tournament.php (echo_tournament_rules),
     scripts/updates/fix_default_max_handi-1_0_16.php (_echo, load_games_gamesetup,
       load_profiles_gamesetup, handle_games_gamesetup, fix_game_invite_dispute,
       fix_game_finished_running, handle_profiles_gamesetup, fix_profile,
       handle_waiting_room_gamesetup, handle_tournament_rules_gamesetup),
     scripts/updates/fix_new_game_expert_view-1_0_16.php (_echo,
       load_profile_templates_new_game_expert_view),
     scripts/updates/database_changes_1_0_15_to_1_0_16.mysql,
     scripts/tests/Game_SettingsHelperTest.php,
     specs/db/dragon-ddl.sql,
     specs/db/table-Games.txt, specs/db/table-Tournaments.txt, specs/db/table-Waitingroom.txt,
     specs/quick_suite.txt, scripts/index.php,
     game_players.php (build_form_change_group, build_tableinfo_handicap_suggestion,
       use_handicap_suggestion),
     new_game.php (handle_add_game),
     gameinfo.php, message.php, site_map.php, waiting_room.php:
   - replaced default for max-handicap from former 21 to board-size-dependent max-handicap
     - selecting "default" for max-handicap will limit the handicap-stones used to start-games
       to a calculated max-default
     - formula used to calculate default max-handicap discussed in DGS-forums:
       round( 7.5 * ( handicapfactor($size) + 0.2 ) )
     - added handicap- and komi-adjustments to invitation and tournament-rules as well
     - merged jigo-check setting for fair-komi with and into jigo-mode setting of adjust-komi section
     - adjust GameSetup-encoding to store handicap- and komi-adjustments
       for all new-game views, invitations including their profiles
     - added migration-script to fix MaxHandicap from old max-handicap-value to default-max-handicap
       for running & finished games, invitation and new-game profiles, waiting-room and
       tournament-rules entries
     - merged simple and expert new-game view into one standard-view shown as default-view
       - previous release 1.0.15 introduced splitted views because of MPG/fair-komi views
       - reverting simple/expert-view split from previous release for easier support of handicap-
         and komi-adjustments, and also to encourage users to use new expert-settings
       - added migration-script to fix merge new-game expert-view with former simple-view
         into merged standard-view for new-game profiles
     - cleanup (minor changes, finer checks)
   - bugfix for game-info-table: show shape-game info for tournament-ladders
   - bugfix: open fair-komi invitation-template in fair-komi-new-game view
-----------
-- added default max-handicap
ALTER TABLE Waitingroom
   MODIFY MaxHandicap tinyint signed NOT NULL default -1 ;
ALTER TABLE TournamentRules
   MODIFY MaxHandicap tinyint signed NOT NULL default -1 ;

-- execute fix-script (with do_it=1) to merge new-game expert-view with standard-view:
--    'scripts/updates/fix_default_max_handi-1_0_16.php'

-- execute fix-script (with do_it=1) to merge new-game expert-view with standard-view:
-- IMPORTANT NOTE: execute script 'fix_default_max_handi-1_0_16.php' before this one!!
--    'scripts/updates/fix_merge_new_game_expert_view-1_0_16.php'
-----------

2013-03-15 juga

   * include/make_translationfiles.php (translation_query),
     translate.php:
   - added selectbox to allow to search for translated-texts only,
     changed 'untranslated'-checkbox to select-box including Untranslated/Translated/All-texts

   * translate.php:
   - added full page-navigation with jump to first/last-page and info with current/max-page

   * include/std_functions.php (echo_dragon_top_bar):
   - added server-version as tooltip in top-bar on DGS-link

   * include/game_functions.php (GameNotify.get_text_game_deleted),
     game_players.php (build_form_delete_game, delete_game_setup),
     specs/multi-player-game.txt:
   - added deletion of MP-game on SETUP-status, but only by game-master,
     notify other players about deletion

   * include/time_functions.php (is_weekend_clock_stopped),
     include/gui_functions.php (echo_off_time),
     game.php, gameinfo.php:
   - bugfix: weekend-clock-icon was always shown on weekend independent from
     game-WeekendClock-setting

   * new_game.php:
   - bugfix: jump to my-waiting-room-games after creation of new game-offer

   * include/classlib_profile.php (class SearchProfile, ~.get_arg, ~.handle_action, ~.to_string),
     include/globals.php (SP_ARG_NO_DEF, SPURL_NO_DEF),
     include/std_functions.php (make_dragon_main_menu),
     features/edit_feature.php, features/list_features.php,
     features/list_votes.php, features/vote_feature.php,
     waiting_room.php (load_waitingroom_info),
     list_shapes.php, site_map.php:
   - bugfixes:
     - fixed profile-handling to not use default-profile on showing "Info" or
       normal "Search" preserving current filter-values
     - fixed showing multi-player-game wroom-entry for correct my|all-view
     - reverted change to add arg-overwriting with additional URL-arg SPURI_ARGS
     - added option for profile-handling to forbid loading default-profile

2013-03-08 juga

   * ratingpng.php (get_rating_data):
   - rating-graph: use 1st rated game as start-time instead of register-date (fallback)

   * translate.php:
   - translating: sort languages for selectbox

   * scripts/sql_game_export.php (export_game):
   - bugfix: handle empty GamePlayers-list

   * tournaments/roundrobin/view_pools.php (build_pool_notes):
   - typo translation-text

2013-01-30 juga

   * include/game_functions.php ($MAP_ACTBY_SUBJECT;
       GameFinalizer.finish_game, ~.get_text_game_deleted, ~.get_text_game_result;
       NextGameOrder.build_status_games_query),
     specs/quick_suite.txt,
     admin_game.php:
   - add user-id and name of author of message in game-deletion and game-finalization message
   - bugfix for quick-status: convert integer next-game-order into enum for loading
     and sorting by manual given order

   * include/game_functions.php (NextGameOrder.build_status_games_query):
   - bugfix for quick-status: convert integer next-game-order into enum
     for loading and sorting by manual given order

   * robots.txt:
   - added Crawl-delay 5s

2013-01-13 juga

   * game.php, manage_sgf.php:
   - added notes with warning about SGF-download
   - fix download-URL

2013-01-12 juga

   * manage_sgf.php:
   - added bottom-link to download SGF WITHOUT any comments

   * waiting_room.php:
   - bugfix: wrong call-args to WaitingroomControl::build_waiting_room_query()

   * include/quick/quick_wroom.php (QuickHandlerWaitingroom.prepare),
     specs/quick_suite.txt:
   - bugfix: added correct default order for waiting-room
   - sync'ed suitable-filter with waiting-room behavior by adding my-waiting-games
     with filter_suitable=2, and by filtering out own waiting-games for all and suitable filter

2013-01-11 juga

   * manage_sgf.php:
   - added "normal" SGF-download bottom-links to ease reviewing

   * include/game_sgf_control.php (GameSgfControl.prepare_verify_game_sgf):
   - bugfix: verify of SGFs with handicap-setup failed, so treat handicap-stones like shape-setup

   * include/game_sgf_control.php (GameSgfControl. delete_game_sgf, ~.save_game_sgf,
       ~.verify_game_sgf, ~.count_cache_game_sgfs, ~.delete_cache_game_sgfs_count),
     include/cache_globals.php (CACHE_GRP_GAMESGF_COUNT, $ARR_CACHE_GROUP_NAMES,
       $ARR_CACHE_GROUP_CLEANUP),
     include/config.php ($DGS_CACHE_GROUPS),
     specs/caching.txt, game.php:
   - use caching to count attached-SGFs on game-page
     - invalidate cache on changing 'AttachedSgf'-game-flags indicator,
       that is on saving or deleting SGF

   * include/game_sgf_control.php (GameSgfControl.delete_game_sgf, ~.save_game_sgf),
     include/db/games.php (Games.parseFlags, ~.buildFlags, ~.update_game_flags),
     include/quick/quick_game_info.php (QuickHandlerGameInfo.convertGameFlags),
     include/gui_functions.php (echo_image_game_sgf),
     include/globals.php (GAMEFLAGS_ATTACHED_SGF),
     scripts/updates/database_changes_1_0_15_to_1_0_16.mysql,
     specs/db/dragon-ddl.sql, specs/db/table-Games.txt, specs/quick_suite.txt,
     game.php, show_games.php, site_map.php:
   - added new column and search-filter for all game-lists for games with attached-SGFs
     - maintain Games.Flags 'AttachedSgf' as indicator if game has attached SGF
     - optimize game-page checking for attached-SGFs only if according game-flag set
     - added special link in site-map to search for all finished games
       with attached SGFs without game-list end-date-restriction
     - refactored printing SGF-icon into echo_image_game_sgf()-function
-----------
-- added 'AttachedSgf'-flag as indicator for the presence of SGFs for game
ALTER TABLE Games
   MODIFY Flags set('Ko','HiddenMsg','AdmResult','TGDetached','AttachedSgf') NOT NULL default '' ;
-----------

2013-01-10 juga

   * include/game_sgf_control.php,
     game.php, manage_sgf.php:
   - allow attaching SGFs also to running game

   * include/game_functions.php (GameHelper._delete_base_game_tables):
   - delete GameSgf-table-entries on game-deletion

   * include/sgf_parser.php (sgf_parser, sgf_parse_node, sgf_parse_args, get_handicap_pattern;
       class SgfParser, ~.might_be_sgf),
     include/game_sgf_control.php (GameSgfControl, ~.save_game_sgf, ~.verify_game_sgf,
       ~.prepare_verify_game_sgf),
     include/board.php (class Board, ~.init_board, ~.load_from_db),
     manage_sgf.php:
   - parses, checks SGF and verifies that game from parsed SGF matches game in database
     - parses and check for correct SGF-format
     - verify for same board-size, handicap, komi, shape-setup and first 25 moves
   - added translatable texts for parsing SGF

   * include/quick/quick_game_notes.php (class QuickHandlerGameNotes, ~.canHandle,
       ~.parseURL, ~.prepare, ~.process),
     include/quick/quick_game_info.php (class QuickHandlerGameInfo, ~.prepare,
       ~.process, ~.fill_game_info),
     include/quick/quick_suite.php (QuickSuite.getQuickHandler),
     specs/quick_suite.txt:
   - added quick-commands for game-object: save_notes, hide_notes, show_notes
   - refactored game-notes 'get_notes'-commands into separate class QuickHandlerGameNotes
   - quick-game-info: return full game-notes instead of length-stripped notes

   * include/game_sgf_control.php (GameSgfControl.delete_game_sgf, ~.save_game_sgf),
     include/globals.php (CSS_VERSION),
     skins/dragon/screen.css,
     manage_sgf.php:
   - ask for confirmation on removing own SGF
   - added 'Refresh'-bottom-link to refresh page
   - bugfix: check if file-read was successful for saving SGF

   * include/db/game_sgf.php (class GameSgf, ~.to_string, ~.persist, ~.insert, ~.update, ~.delete,
       ~.fillEntityData, ~.build_query_sql, ~.new_from_row, ~.load_game_sgf, ~.load_game_sgfs,
       ~.count_game_sgfs),
     include/game_sgf_control.php (class GameSgfControl, ~.delete_game_sgf, ~.save_game_sgf,
       ~.download_game_sgf),
     scripts/updates/database_changes_1_0_15_to_1_0_16.mysql,
     scripts/updates/other_changes_1_0_15_to_1_0_16.txt,
     specs/db/table-Games.txt, specs/db/dragon-ddl.sql,
     game.php, manage_sgf.php, people.php, site_map.php:
   - allow to upload SGFs for finished games
     - added manage-sgf page to add, update, delete and download SGFs
     - allow one SGF per game and user
     - max. upload file-size 100KB
     - game-page shows new sgf-icon if there are attached SGFs to download
     - show 'Attach SGF' bottom-link on game-page for finished games
-----------
-- added table to store attached SGFs for games
CREATE TABLE GameSgf (
  gid int NOT NULL,
  uid int NOT NULL,
  Lastchanged datetime NOT NULL default '0000-00-00 00:00:00',
  SgfData blob NOT NULL,
  PRIMARY KEY (gid,uid)
) ENGINE=MyISAM ;
-----------

   * include/game_functions.php (MultiPlayerGame.update_players_end_mpgame;
       GameHelper.delete_running_game, ~.update_players_end_game):
   - bugfix: deleting a multi-player-game changed wrongly Players.Running/Finished-fields

2013-01-07 juga

   * include/message_functions.php (game_info_table),
     include/utilities.php (append_unique),
     scripts/updates/database_changes_1_0_15_to_1_0_16.mysql,
     site_map.php, waiting_room.php:
   - changed waiting-room view:
     - added view 'My waiting games' only showing own waiting games
     - replaced boolean-filter for suitable with selectbox with All/Suitable/Mine
     - All and Suitable waiting games do not show own games
     - removed 'New Game' bottom-link
     - adjusted tooltip-text 'Out of range' to the more general 'Restricted'
     - changed existing bottom-link translation-texts without losing translations
-----------
-- change existing translation-text for waiting-room without losing translations
UPDATE TranslationTexts
   SET Text='All waiting games', Translatable='Y', Updated=NOW()
   WHERE Text='Show all waiting games' LIMIT 1 ;
UPDATE TranslationTexts
   SET Text='Suitable waiting games', Translatable='Y', Updated=NOW()
   WHERE Text='Show suitable games only' LIMIT 1 ;
-----------

   * include/classlib_profile.php (class SearchProfile):
   - bugfix: initializing overwrite-args ignoring leading and trailing separators

2013-01-05 juga

   * include/std_functions.php (check_for_observers):
   - bugfix: add 'show observers'-link if game is observed by myself

   * snapshot.php:
   - added notes how to create tarballs of code-snapshot, translation-data, images

   * admin_faq.php:
   - bugfixes:
     - keep expand-all-view on editing entry and coming back to list,
       and on all other list-actions
     - expand all categories on moving entry into new category up or down

   * include/quick_common.php (DATE_FMT_TZ),
     rss/status.php (rss_open),
     wap/status.php:
   - RSS-status: added RSS-channel-tag 'lastBuildDate'
   - RSS-status: added human-readable built-date in channel-text
   - WAP-status: added human-readable built-date in card-item

   * include/message_functions.php (message_info_table),
     game.php, game_comments.php, message.php,
     message_thread.php (echo_message_row):
   - show game-board for <igoban>-tag for
     - private messages on send message, preview message, view message,
       view message-thread
     - game-move messages on preview move-message for submitting move,
       view game, view game-comments

   * include/std_functions.php (LOGIN_NO_QUOTA_HIT, is_logged_in),
     admin_faq.php, translate.php:
   - don't decrease quota on FAQ-editing & translating

   * list_bulletins.php:
   - bugfix bulletin-list: view-bulletin may only be allowed to specific user

   * people.php:
   - comment out older developers
   - cleanup: avoid translations for unimportant texts describing origin of icons

   * translate.php:
   - bugfix for previous removed const TRANSL_ALLOW_FILTER:
     interpreted if-expression with TRANSL_ALLOW_FILTER in wrong way

   * include/sgf_builder.php (SgfBuilder.formatPlayerName):
   - changed node-text for multi-player-game: added current rating of moving
     player as well besides user-id to know who has moved

2012-12-18 juga

   * scripts/translation_consistency.php (check_consistency_faq_refs, fix_faq_reference,
       replace_faq_ref_text_callback):
   - added check to correct references to FAQ correcting category of moved entries
     to new categories

2012-12-17 juga

   * include/table_columns.php (Table.set_default_sort):
   - bugfix: sort-order reverse was not possible any more

   * scripts/translation_consistency.php:
   - bugfix: correct check on missing TranslationFoundInGroup reporting wrong-text-id

2012-12-16 juga

   * users.php:
   - bugfix: enforce NO_HIDE for table-column Rating for show user-rating-pos

   * game_players.php (build_form_start_game),
     game.php:
   - corrected wrong msg-icon for 'Send message' for MPG-message

   * include/table_columns.php (Table.set_default_sort, ~.set_sort, ~.make_sort_images,
       ~.current_order_string):
   - bugfix: ensure, that used db-fields/aliases for sorting are only used for visible table-column

